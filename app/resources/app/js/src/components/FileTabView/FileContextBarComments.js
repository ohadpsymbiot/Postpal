"use strict";(self.webpackChunk_postman_app_renderer=self.webpackChunk_postman_app_renderer||[]).push([[157],{"../../packages/api-design/schema-editor/src/components/FileTabView/FileContextBarComments.js":function(e,t,o){o.r(t),o.d(t,{default:function(){return F}});var n,s=o("../../node_modules/react/index.js"),a=o("../../node_modules/classnames/index.js"),r=o.n(a),i=o("../../node_modules/mobx-react/dist/mobx-react.module.js"),l=o("./js/stores/StoreManager.js"),d=o("./js/stores/AnnotationStore.js"),m=o("./js/stores/CommentStore.js"),c=o("./js/stores/CurrentUserStore.js"),h=o("./js/stores/TeamUserStore.js"),p=o("./js/stores/SyncStatusStore.js"),u=o("./js/utils/UserHelper.js"),f=o("./collaboration/services/ContextBarCommentService.js"),C=o("./collaboration/services/CollaborationNavigationService.js"),g=o("./collaboration/components/comments/InlineCommentDrawer.js"),v=o("./js/modules/services/InlineCommentTransformerService.js"),S=o("./collaboration/services/PermissionService.js"),b=(o("./collaboration/constants/comments.js"),o("./js/components/base/Buttons.js")),x=o("./js/components/base/Dropdowns.js"),I=o("./js/components/base/Inputs.js"),E=o("../../node_modules/@postman/aether-icons/esmLib/src/Icon/Icon.js"),_=o("./appsdk/contextbar/ContextBarViewHeader.js"),j=o("./collaboration/utils/commentUtils.js"),D=o("../../packages/api-design/schema-editor/src/components/FileTabView/FileOffline.js"),w=o("../../node_modules/lodash/lodash.js");let F=(0,i.observer)(n=class extends s.Component{constructor(e){super(e),this.state={loading:!0,loadError:!1,hasError:!1,isOpenFilterSelected:!0,isResolvedFilterSelected:!1,isScrollable:!0},this.rightOverlayModalRef=null,this.parseError=this.parseError.bind(this),this.handleRetry=this.handleRetry.bind(this),this.handleResolvedFilter=this.handleResolvedFilter.bind(this),this.handleOpenFilter=this.handleOpenFilter.bind(this),this.setCommentDrawerRef=this.setCommentDrawerRef.bind(this),this.stopScroll=this.stopScroll.bind(this),this.handleClose=this.handleClose.bind(this),this.onInlineCommentThreadHeaderClick=this.onInlineCommentThreadHeaderClick.bind(this)}async componentDidMount(){this.setState({loading:!0,loadError:!1}),v.default.handleAnalytics("api","view","api"),f.default.getComments({model:w.get(this.props.contextData,"commentModel"),modelId:w.get(this.props.contextData,"commentModelId"),parentModel:w.get(this.props.contextData,"parentModel"),parentModelId:w.get(this.props.contextData,"parentModelId")}).then((()=>{requestIdleCallback((()=>{(0,l.resolveStoreInstance)(m.default).setLoaded(!0),this.setState({loading:!1,loadError:!1})}))})).catch((e=>{this.setState({loading:!1,loadError:!0})}));let e=w.get(this.props.contextData,"commentModel"),t=w.get(this.props.contextData,"commentModelId"),o=w.get(this.props.contextData,"parentModel"),n=(0,j.getCommentPermissionModelInfo)({model:e,modelId:t,parentModel:o}),{addComment:s,deleteComment:a,resolveComment:r}=await(0,S.fetchPermissions)(["addComment","deleteComment","resolveComment"],n.modelId,n.model);this.setState({addCommentPermission:s,deleteCommentPermission:a,resolveCommentPermission:r})}componentDidUpdate(){if(!this.state.isResolvedFilterSelected){const e=(0,l.resolveStoreInstance)(m.default),t=e.find(e.activeCommentId),o=(0,l.resolveStoreInstance)(d.default).find(w.get(t,"annotationId"));w.get(o,"status.resolved")&&this.handleResolvedFilter()}}handleOpenFilter(){this.setState((e=>{if(!e.isOpenFilterSelected||e.isResolvedFilterSelected)return{isOpenFilterSelected:!e.isOpenFilterSelected}}))}handleResolvedFilter(){this.setState((e=>{if(e.isOpenFilterSelected||!e.isResolvedFilterSelected)return{isResolvedFilterSelected:!e.isResolvedFilterSelected}}))}parseError(e){return e.isFriendly?e.message:""}handleRetry(){return this.setState({loading:!0,loadError:!1}),f.default.getComments({model:w.get(this.props.contextData,"commentModel"),modelId:w.get(this.props.contextData,"commentModelId"),parentModel:w.get(this.props.contextData,"parentModel"),parentModelId:w.get(this.props.contextData,"parentModelId")}).then((()=>{this.setState({loading:!1,loadError:!1})})).catch((e=>{this.setState({loading:!1,loadError:!0})}))}setCommentDrawerRef(e){this.commentDrawerRef=e,this.commentDrawerRef&&this.forceUpdate()}stopScroll(e){this.setState({isScrollable:!e})}handleClose(){this.props.onClose&&this.props.onClose(),C.default.removeCommentQueryParam()}onInlineCommentThreadHeaderClick(){w.isFunction(this.props.contextData.handleTabChange)&&this.props.contextData.handleTabChange("define")}render(){let{commentModel:e,commentModelId:t}=this.props.contextData||{},o=w.filter((0,l.resolveStoreInstance)(m.default).values,(o=>o.model===e&&o.modelId===t)),n=this.props.contextData.name,a=(0,l.resolveStoreInstance)(c.default)||{},i=(0,l.resolveStoreInstance)(h.default),d=w.reduce(i.values,((e,t)=>(e[t.id]={name:t.name,id:t.id,username:t.username,email:t.email,profilePicUrl:t.profilePicUrl,roles:t.roles},e)),{}),f=Object.values(d),C=!(0,l.resolveStoreInstance)(p.default).isSocketConnected,v=(0,u.isUserAdmin)(a),S=w.reduce((o||[]).reverse(),((e,t)=>(e.includes(t.annotationId)||e.push(t.annotationId),e)),[]),j=(0,l.resolveStoreInstance)(m.default),F=j.find(j.activeCommentId),M=j.setActiveCommentId;return C&&this.state.loading?s.createElement(s.Fragment,null,s.createElement(_.ContextBarViewHeader,{onClose:this.props.onClose,title:"Comments"}),s.createElement(D.default,{origin:"context-bar"})):s.createElement("div",{className:r()({"comment-drawer-container":!0,"no-scroll":!this.state.isScrollable}),ref:this.setCommentDrawerRef},s.createElement(_.ContextBarViewHeader,{onClose:this.handleClose,title:"Comments"},s.createElement("div",{className:"comment-drawer-container__actions"},s.createElement("div",{className:"comment-drawer-container__actions-filter"},s.createElement(x.Dropdown,null,s.createElement(x.DropdownButton,{dropdownStyle:"nocaret"},s.createElement(b.Button,{className:"comment-drawer-container__actions-filter-button",type:"tertiary",tooltip:"Filter comments",disabled:!o.length},s.createElement(E.default,{name:"icon-action-filter-stroke"}))),s.createElement(x.DropdownMenu,{className:"comment-drawer-container__actions-filter-menu"},s.createElement("div",{className:"comment-drawer-container__actions-filter--action-header"},"Filter by"),s.createElement("div",{className:"comment-drawer-container__actions-filter--action-item"},s.createElement(I.Checkbox,{className:"comment-filter-dropdown-item-checkbox",checked:this.state.isOpenFilterSelected,onChange:this.handleOpenFilter}),s.createElement("span",{className:"comment-drawer-container__actions-filter--action-item-name"},"Open comments")),s.createElement("div",{className:"comment-drawer-container__actions-filter--action-item"},s.createElement(I.Checkbox,{className:"comment-filter-dropdown-item-checkbox",checked:this.state.isResolvedFilterSelected,onChange:this.handleResolvedFilter}),s.createElement("span",{className:"comment-drawer-container__actions-filter--action-item-name"},"Resolved comments"))))))),s.createElement("div",{className:"comment-drawer"},s.createElement(g.default,{hideHeaderComments:!0,editor:w.get(this.props.contextData,"editor"),comments:o,onInlineCommentThreadHeaderClick:this.onInlineCommentThreadHeaderClick,requestComments:[],inlineAnnotationsFilter:e=>e.anchor===w.get(this.props.contextData,"anchor"),annotationOrder:S,isResolvedFilterSelected:this.state.isResolvedFilterSelected,isOpenFilterSelected:this.state.isOpenFilterSelected,addCommentPermission:this.state.addCommentPermission,deleteCommentPermission:this.state.deleteCommentPermission,resolveCommentPermission:this.state.resolveCommentPermission,isAdmin:v,isOffline:C,loading:this.state.loading,loadError:this.state.loadError,hasError:this.state.hasError,teamUsers:f,teamUsersMap:d,onRetry:this.handleRetry,user:a,title:n,stopScroll:this.stopScroll,commentRef:this.commentDrawerRef,commentLinkDisabled:w.get(this.props.contextData,"commentLinkDisabled"),model:w.get(this.props.contextData,"commentModel"),modelId:w.get(this.props.contextData,"commentModelId"),parentModel:w.get(this.props.contextData,"parentModel"),parentModelId:w.get(this.props.contextData,"parentModelId"),supportsInlineComments:!0,activeComment:F,setActiveComment:M,origin:"contextBar",anchor:w.get(this.props.contextData,"anchor")})))}})||n},"../../packages/api-design/schema-editor/src/components/FileTabView/FileOffline.js":function(e,t,o){o.r(t),o.d(t,{default:function(){return r}});var n=o("../../node_modules/react/index.js"),s=o("../../node_modules/@postman/aether/esmLib/src/components/Illustration/illustrations/CheckInternetConnection.js"),a=o("../../node_modules/@postman/aether/esmLib/src/components/Text/Text.js");class r extends n.Component{getHeadingColor(){return"sidebar"===this.props.origin?"content-color-secondary":"content-color-primary"}render(){return n.createElement("div",{className:`file-offline ${this.props.origin}`},n.createElement("div",{className:"file-offline__blank-state"},n.createElement(s.default,null)),n.createElement("div",{className:"file-offline__content"},n.createElement("div",{className:"file-offline__content__header"},n.createElement(a.default,{color:this.getHeadingColor(),typographyStyle:{fontSize:"text-size-l",fontWeight:"text-weight-medium",lineHeight:"line-height-m"}},"Unable to load data as you're offline")),n.createElement("div",{className:"file-offline__content__sub-header"},n.createElement(a.default,{color:"content-color-secondary",typographyStyle:{fontSize:"text-size-m",fontWeight:"text-weight-regular",lineHeight:"line-height-m"}},"Your data may not be up to date until youâ€™re back online."))))}}}}]);