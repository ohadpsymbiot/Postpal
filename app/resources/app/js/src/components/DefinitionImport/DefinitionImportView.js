"use strict";(self.webpackChunk_postman_app_renderer=self.webpackChunk_postman_app_renderer||[]).push([[155],{"../../packages/api-design/api-definition-ui/src/components/DefinitionImport/DefinitionEntityContainer.js":function(e,t,i){i.r(t);var n,s=i("../../node_modules/react/index.js"),a=i("../../node_modules/mobx-react/dist/mobx-react.module.js"),o=i("../../node_modules/@postman/aether/esmLib/src/components/Radio/Radio.js"),l=i("../../node_modules/@postman/aether/esmLib/src/components/Flex/Flex.js"),r=i("../../node_modules/@postman/aether/esmLib/src/components/Text/Text.js"),p=i("../../node_modules/@postman/aether/esmLib/src/components/Button/Button.js"),d=i("../../node_modules/@postman/aether/esmLib/src/components/Toast/withToast.js"),c=i("../../node_modules/@postman/aether-icons/esmLib/src/design-system-icons/icon-direction-down.js"),m=i("../../node_modules/@postman/aether-icons/esmLib/src/design-system-icons/icon-direction-right.js"),h=i("../../packages/api-design/import/index.js"),f=i("./api-dev/stores/APIListStore.js"),u=i("./api-dev/services/APIPermissionService.js"),g=i("../../packages/api-design/api-definition-store/index.js"),I=i("./js/services/NavigationService.js"),y=i("./js/stores/StoreManager.js"),E=i("./js/stores/SyncStatusStore.js"),v=i("../../packages/api-design/api-design-analytics/index.js"),F=i("../../packages/api-design/api-definition-ui/src/utils/Definition.js"),S=i("../../node_modules/lodash/lodash.js");let b=(0,a.observer)(n=class extends s.Component{constructor(e){super(e),this.state={isImporting:!1,clickedButton:null,expansionState:null,selectedDefinition:null,canImport:!1},this.handleCreateDefinitionFromImport=this.handleCreateDefinitionFromImport.bind(this)}componentDidMount(){if(this.props.directImport)this.setState({selectedDefinition:0,canImport:!0});else for(let e of this.props.fileList.items)e.setIsSelected(!1)}async handleCreateDefinitionFromImport(e){this.setState({isImporting:!0});const t=this.props.apiId,i=this.props.apiVersionId,n=this.props.apiName,{addToast:s}=this.props,a=S.get(this.props,"fileStore.mode"),o={name:"sample",data:{title:"Sample API",version:"1.0.0"}};S.get(I.default.getActiveQueryParams().get(),"branch");(0,v.logApiDesignAnalytics)({category:v.EVENT_CATEGORIES.CREATE_API_DEFINITION,action:v.EVENT_ACTIONS.USE_THIS_DEFINITION_CLICK,label:S.get(e,"file.format.apiDefinitionType"),entityId:t,entityType:v.EVENT_ENTITY_TYPES.API,value:S.get(this.props.fileList,"items.length",0)});try{const s=S.get(e,"file");let l,r,p,d=S.get(s,"format.apiDefinitionType"),c={type:"file",content:s.content,name:s.path.split("/").pop(),language:s.language,path:s.path},m=[];if(g.APIDefinitionTypeService.isRootTaggable(d)&&(c.root={enabled:!0}),g.APIDefinitionTypeService.isMultiFileSupported(d)&&e.isMultiFile)if("proto:2"==d||"proto:3"==d){for(let t of e.entityMap.values())if("file"===t.kind&&t.isSelected){const e={type:"file",content:t.content,name:t.name,path:t.path};"/"===e.path.charAt(0)&&e.path.length>1&&(e.path=e.path.substring(1)),t.isRoot&&(e.root={enabled:!0}),m.push(e)}p=!0}else m=S.map(S.get(s,"relatedFiles"),(e=>({type:"file",content:e.content,language:e.language,name:e.name,path:e.path})));if(p||m.push(c),!a&&(g.APIDefinitionTypeService.getDefinitionTypeFromSchemaType(d)&&(d=g.APIDefinitionTypeService.getDefinitionTypeFromSchemaType(d)),!p&&1==m.length&&S.isEqual(m[0],c))){let e=c.name,t=e.split(".").slice(0,-1).join("."),i=e.split(".").pop(),n=g.APIDefinitionTypeService.determineFileExtension(d,s.language);n&&n!=i&&("yaml"===n&&"yml"===i||(c.name=`${t||e}.${n}`,c.path=`${t||e}.${n}`)),m=[c]}return l=await(0,F.createOrReplaceDefinition)({apiId:t,apiVersionId:i,items:m,options:{type:d,format:this.state.definitionFormat,defaultTemplate:o,apiName:n}}),r=await l.getRedirectionFileId(),this.setState({isImporting:!1}),this.props.handleClose&&await this.props.handleClose(),void I.default.transitionTo("build.apiDefinitionFile",{apiId:t,apiVersionId:i,apiDefinitionId:l.id,fileId:r})}catch(e){let t;t="InvalidParamsError"==S.get(e,"error.name")?"Something went wrong while creating Definition. Please try again.":"Something went wrong while creating Definition. Try again.",this.setState({isImporting:!1}),s({status:"error",description:t}),pm.logger.error("DefinitionEntityContainer~handleCreateDefinitionFromImport: Failed to create Definition - ",t)}}handleAPISelection(){this.setState({clickedButton:this.state.selectedDefinition}),this.handleCreateDefinitionFromImport(this.props.fileList.items[this.state.selectedDefinition])}setSelectedDefinition(e,t=!0){this.props.fileList.items.map(((i,n)=>{n==e?t&&i.setIsSelected(!0):i.setIsSelected(!1)})),this.setState({selectedDefinition:e,canImport:!0})}render(){const e=this.props.apiId,t=(0,y.resolveStoreInstance)(f.default).permissions,i=u.default.hasPermission(t,"updateSchema","api",e);let n=this.props.fileList.items.map(((e,t)=>{let i=0;if(!e.isVisible)return null;if(e.isMultiFile)for(let t of null===(n=e.entityMap)||void 0===n?void 0:n.values()){var n;"file"!==t.kind||S.includes(["proto2","proto3"],S.get(e,"file.format.id"))&&e.isSelected&&!t.isSelected||i++}else i=1;return s.createElement("div",{key:t,className:"import-entity-table-content-container"},s.createElement("div",{className:"import-entity-table-content"},!this.props.directImport&&s.createElement("div",{className:"import-definition-radio-button-container",onClick:()=>{this.setSelectedDefinition(t)}},s.createElement(o.default,{className:"import-definition-radio-button",value:`${t}`,label:"",_isChecked:e.isSelected})),s.createElement("div",{className:"import-entity-table-content-file-list"},s.createElement("div",{className:"import-entity-table-content-name"},s.createElement("div",{onClick:()=>{e.toggleIsExpanded()}},s.createElement(l.default,{direction:"row"},s.createElement("div",{className:"api-definition-name-text-details"},s.createElement("div",{onClick:()=>{this.setSelectedDefinition(t)}},s.createElement(r.default,{type:"body-medium",isTruncated:!0},e.name),s.createElement("span",null,"  "),s.createElement(r.default,{type:"body-medium",color:"content-color-secondary",isTruncated:!0},"·  ",e.file.format.name)),e&&s.createElement(l.default,{direction:"row"},s.createElement("div",{className:"multifile-arrow-pad"},e.isExpanded?s.createElement(c.default,null):s.createElement(m.default,null)),s.createElement(r.default,{color:"content-color-secondary"},i," file"+(i>1?"s":""))))))))),s.createElement(l.default,{padding:{paddingLeft:"spacing-xl"},backgroundColor:"background-color-tertiary",className:"entity-filetable-container"},e.isExpanded?S.includes(["proto2","proto3"],S.get(e,"file.format.id"))&&e.isMultiFile?s.createElement(h.ProtoFileTable,{file:e,index:t,setSelectedDefinition:this.setSelectedDefinition.bind(this)}):s.createElement(h.FileTable,{file:e}):null))}));return n=S.filter(n,(e=>null!==e)),0===n.length?null:s.createElement(s.Fragment,null,s.createElement("div",{className:"import-container-entity import-container-entity-margin-override element-table-overflow-scroll"},s.createElement("div",{className:"import-definition-entity-header"}),s.createElement("div",{className:"import-entity-table"},n)),s.createElement(l.default,{className:"create-definition-cta-footer"},s.createElement(p.default,{type:"primary",text:"Import",isDisabled:!this.state.canImport||!i||this.state.isImporting||!(0,y.resolveStoreInstance)(E.default).isSocketConnected,onClick:this.handleAPISelection.bind(this),isLoading:this.state.isImporting,tooltip:i?"":s.createElement(Tooltip,{content:"You do not have access to perform this action.",placement:"auto"})})))}})||n;t.default=(0,d.default)(b)},"../../packages/api-design/api-definition-ui/src/components/DefinitionImport/DefinitionImportView.js":function(e,t,i){i.r(t),i.d(t,{default:function(){return I}});var n,s=i("../../node_modules/lodash/lodash.js"),a=i.n(s),o=i("../../node_modules/react/index.js"),l=i("../../node_modules/mobx-react/dist/mobx-react.module.js"),r=i("../../node_modules/mobx/lib/mobx.module.js"),p=i("./js/services/EditorService.js"),d=i("../../packages/api-design/import/index.js"),c=i("./js/services/NavigationService.js"),m=i("../../node_modules/@postman/aether/esmLib/src/components/Spinner/Spinner.js"),h=i("../../node_modules/@postman/aether/esmLib/src/components/Banner/Banner.js"),f=i("../../node_modules/@postman/aether/esmLib/src/components/Button/Button.js"),u=i("../../packages/api-design/api-definition-ui/src/components/DefinitionImport/DefinitionEntityContainer.js"),g=i("../../node_modules/@postman/aether-icons/esmLib/src/design-system-icons/icon-entity-api-stroke.js");let I=(0,l.observer)(n=class extends o.Component{constructor(e){super(e),this.state={apis:null,others:null,isLoading:!0,optionsPreference:{}},this.navigateBackToCreateDefinition=this.navigateBackToCreateDefinition.bind(this)}assignToFolder(e,t,i,n){if(!e.path||"string"!=typeof e.path)return;let s=e.path;if("/"!==s.charAt(0)&&(s="/"+s),t.has(s))return;let o=s.split("/"),l=o[o.length-1],r=new d.Entity({kind:"file",path:s,name:l,content:e.content,language:e.language,isSelected:i,isRootCandidate:n});o.splice(o.length-1),0===o.length&&o.unshift("/");let p="";for(let e of o){const n=("/"===p?"":p)+"/"+e;let s;if(t.has(n)?s=t.get(n):(s=new d.Entity({kind:"folder",name:e,path:n,isSelected:i}),t.set(n,s)),""!==p){let e=t.get(p),i=a().map(e.items,(e=>e.path));a().includes(i,s.path)||(e.items.push(s),s.setParent(e))}p=n}let c=t.get(p);c.items.push(r),r.setParent(c),t.set(r.path,r)}componentDidMount(){(0,r.when)((()=>this.props.controller.isProcessingComplete),(()=>{const e=this.props.controller.files,t=new d.Entity,i=new d.Entity;for(let n of e)if(a().isArray(n.relatedFiles)&&n.relatedFiles.length>0){const e=this.processMultiFile(n);e.parent=t,t.items.push(e)}else a().includes(n.importAsFormats,"API")?t.items.push(new d.Entity({file:n,parent:t,name:n.name})):i.items.push(new d.Entity({file:n,parent:i,name:n.name}));this.setState({apis:t,others:i,isLoading:!1})})),(0,r.when)((()=>this.props.controller.shouldCloseTab),(()=>this.handleClose()))}processMultiFile(e){const t=new Map;this.assignToFolder(e,t,true,!(!e.candidateRootFiles||!e.candidateRootFiles[e.path]));for(let i of e.relatedFiles)this.assignToFolder(i,t,true,!(!e.candidateRootFiles||!e.candidateRootFiles[i.path]));const i=t.get("/");i.entityMap=t,i.file=e,i.name=e.name,i.isMultiFile=!0,i.relatedFiles=e.relatedFiles,i.candidateRootFiles=e.candidateRootFiles,(e=t.has("/"+e.path)?t.get("/"+e.path):t.get(e.path)).setIsRoot(!0);const n=this.pruneFolders(i);return a().includes(["proto2","proto3"],a().get(i,"file.format.id"))&&(i.candidateRootFiles&&0!==Object.keys(i.candidateRootFiles).length?this.setSelectedForRootDepencies(n):e.setIsRoot(!1)),n}setSelectedForRootDepencies(e){let t=[];e.candidateRootFiles[e.file.path]&&e.candidateRootFiles[e.file.path].relatedFiles?t=e.candidateRootFiles[e.file.path].relatedFiles:e.candidateRootFiles[e.file.fullPath]&&e.candidateRootFiles[e.file.fullPath].relatedFiles&&(t=e.candidateRootFiles[e.file.fullPath].relatedFiles),t.forEach((t=>{e.entityMap.has("/"+t)?e.entityMap.get("/"+t).setIsSelected(!0):e.entityMap.get(t).setIsSelected(!0)}))}pruneFolders(e){var t;const i=e;let n="";for(;e&&"folder"===e.kind&&1==a().size(e.items)&&"folder"===e.items[0].kind;)n=e.path,e=e.items[0];e.entityMap=i.entityMap,e.file=i.file,e.name=i.name,e.isMultiFile=!0,e.relatedFiles=i.relatedFiles,e.candidateRootFiles=i.candidateRootFiles,n+="/";for(let t of e.entityMap.values())0===t.path.search(n)&&(t.fullPath=t.path,t.path=t.path.replace(n,""));0===(null===(t=e.file)||void 0===t?void 0:t.path.search(n))&&(e.file.fullPath=e.file.path,e.file.path=e.file.path.replace(n,""));for(let t of e.relatedFiles)0===t.path.search(n)&&(t.path=t.path.replace(n,""));return e}async handleClose(){await p.default.close({id:this.props.id})}navigateBackToCreateDefinition(){c.default.transitionTo("build.createDefinition",a().pick(this.props,["apiId"]),a().pick(c.default.getActiveQueryParams().get(),["branch"]),{tabOptions:{openIn:this.props.id}})}shouldDirectImport(){return 1==this.state.apis.items.length}render(){return a().get(this.props.controller,"isLoading")||this.state.isLoading?o.createElement("div",{className:"import-container-loading"},o.createElement(m.default,null)):o.createElement("div",{className:"import-container-main"},o.createElement("div",{className:"import-container-content element-table-height-fill"},o.createElement("h2",null,this.shouldDirectImport()?"Import Definition":"Choose one Definition from the list"),this.state.apis&&this.state.apis.items.length>0?o.createElement(u.default,{icon:o.createElement(g.default,null),title:"APIs",columnLeft:"Definition name",columnRight:"Definition type",fileList:this.state.apis,apiId:a().get(this.props.controller.opts,"apiId"),apiVersionId:a().get(this.props.controller.opts,"apiVersionId"),apiName:a().get(this.props.controller.opts,"apiName"),fileStore:a().get(this.props.controller.opts,"fileStore"),isAPI:!0,directImport:this.shouldDirectImport(),handleClose:this.handleClose.bind(this)}):o.createElement("div",null,o.createElement(h.default,{status:"neutral",type:"local"},"Looks like your imported data doesn't contain any API specifications."," ",o.createElement(f.default,{type:"plain",text:"Go Back",tooltip:"Navigate back to API Overview",onClick:this.navigateBackToCreateDefinition})))))}})||n}}]);