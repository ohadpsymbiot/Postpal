"use strict";(self.webpackChunk_postman_app_renderer=self.webpackChunk_postman_app_renderer||[]).push([[163],{"../../packages/api-design/api-definition-ui/src/controllers/CreateDefinitionWorkbenchController.js":function(e,i,t){t.r(i),t.d(i,{default:function(){return _}});var r,n,a,o,s,l,c,d=t("../../node_modules/mobx/lib/mobx.module.js"),u=t("../../node_modules/lodash/lodash.js"),p=t.n(u),b=t("../../node_modules/@postman/aether/esmLib/src/components/Toast/ToastManager.js"),g=t("./appsdk/workbench/BaseWorkbenchController.js"),h=t("./js/services/EditorService.js"),f=t("./api-dev/interfaces/APIInterface.js"),m=t("../../packages/api-design/api-definition-ui/src/constants/mode.js"),I=t("./js/stores/StoreManager.js"),y=t("./js/stores/SyncStatusStore.js"),E=t("../../packages/api-design/api-design-analytics/index.js");function v(e,i,t,r){t&&Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(r):void 0})}function T(e,i,t,r,n){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce((function(t,r){return r(e,i,t)||t}),a),n&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(n):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,i,a),a=null),a}const w=pm.logger.getContext("api-definition-ui","api-design");let _=(r=class extends g.default{constructor(...e){super(...e),v(this,"apiId",n,this),v(this,"apiVersionId",a,this),v(this,"apiName",o,this),v(this,"apiVersionName",s,this),v(this,"mode",l,this),v(this,"isLoading",c,this)}showErrorToast(){(0,b.toast)({status:"error",description:"Something went wrong. Please try again"})}closeTab(){h.default.close({id:this.tabId})}async didCreate({routeParams:e,queryParams:i}){let t;this.setIsLoading(!0),this.apiId=p().get(e,"apiId");try{await(0,d.when)((()=>(0,I.resolveStoreInstance)(y.default).isSocketConnected)),t=await(0,f.getAPI)(this.apiId)}catch(e){return pm.logger.error("CreateDefinitionWorkbenchController~didCreate",e,{context:w}),this.showErrorToast(),void this.closeTab()}this.apiName=p().get(t,"name"),this.apiVersionId=p().get(t,"version.id"),this.apiVersionName=p().get(t,"version.name");if(p().get(i,"branch")){this.mode=m.FEATURE_BRANCH_MODE;try{this.fileStore=await(0,f.getAPILinkedEntityModel)(this.apiId,{name:"branch"},"apiDefinition","")}catch(e){return pm.logger.error("CreateDefinitionWorkbenchController~didCreate",e,{context:w}),this.showErrorToast(),void this.closeTab()}}this.setIsLoading(!1)}setIsLoading(e){this.isLoading=e}beforeDestroy(){(0,E.logApiDesignAnalytics)({category:E.EVENT_CATEGORIES.CREATE_API_DEFINITION,action:E.EVENT_ACTIONS.CREATE_DEFINITION_TAB_X,entityId:p().get(this,"apiId"),entityType:E.EVENT_ENTITY_TYPES.API})}},n=T(r.prototype,"apiId",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=T(r.prototype,"apiVersionId",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),o=T(r.prototype,"apiName",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s=T(r.prototype,"apiVersionName",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=T(r.prototype,"mode",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m.API_BUILDER_MODE}}),c=T(r.prototype,"isLoading",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),T(r.prototype,"setIsLoading",[d.action],Object.getOwnPropertyDescriptor(r.prototype,"setIsLoading"),r.prototype),r)}}]);