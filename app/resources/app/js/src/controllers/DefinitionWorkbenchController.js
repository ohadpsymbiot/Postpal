"use strict";(self.webpackChunk_postman_app_renderer=self.webpackChunk_postman_app_renderer||[]).push([[165],{"../../packages/api-design/api-definition-ui/src/controllers/DefinitionWorkbenchController.js":function(e,i,t){t.r(i),t.d(i,{default:function(){return R}});var n,s,a,o,r=t("./appsdk/workbench/BaseWorkbenchController.js"),d=t("../../packages/api-design/api-definition-store/index.js"),l=t("./js/stores/StoreManager.js"),p=t("./api-dev/stores/APIListStore.js"),c=t("../../node_modules/mobx/lib/mobx.module.js"),h=t("../../packages/api-design/api-definition-ui/src/utils/Definition.js"),u=t("../../packages/api-design/api-definition-ui/src/constants/urls.js"),I=t("./appsdk/workbench/WorkbenchService.js"),f=t("./js/utils/urlUtils.js"),m=t("./js/modules/services/APITabUpdateHelpers.js"),D=t("./api-dev/constants/APITabModes.js"),b=t("./api-dev/interfaces/APIInterface.js"),P=t("./js/modules/model-event.js"),g=t("./schema/constants/Constants.js"),v=t("./js/services/NavigationService.js"),y=t("./js/stores/SyncStatusStore.js"),E=t("../../node_modules/lodash/lodash.js");function A(e,i,t,n){t&&Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function w(e,i,t,n,s){var a={};return Object.keys(n).forEach((function(e){a[e]=n[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),a),s&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(s):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,i,a),a=null),a}const{API_NO_PERMISSION:_,API_REDIRECT_CONSUMER_ENTITY:j}=g.INTERMEDIATE_DEFINITION_VIEW;let R=(n=class extends r.default{constructor(){super(),A(this,"apiDefinitionModel",s,this),A(this,"isModelLoading",a,this),A(this,"intermediateView",o,this),this.handleRequestForAccessOnParentAPI=this.handleRequestForAccessOnParentAPI.bind(this),this.handleRedirectToAPIConsumerDefinition=this.handleRedirectToAPIConsumerDefinition.bind(this)}async didCreate({routeParams:e,queryParams:i}){try{this.apiId=E.get(e,"apiId"),this.apiVersionId=E.get(e,"apiVersionId"),this.apiDefinitionId=E.get(e,"apiDefinitionId"),this.queryParams=i||{},this.setLoading(!0),await(0,l.resolveStoreInstance)(y.default).onSyncAvailable();const t=await m.default.resolveActiveModeForLinkedEntities(e.apiId,i);this.apiMode=t;const n=(0,l.resolveStoreInstance)(d.APIDefinitionStore),s=await n.getDefinitionFromAPI(this.apiId,t,this.apiVersionId);if((t.name===D.VERSION_VIEW||t.name===D.BUILDER_VIEW&&!s)&&(await this.determineIntermediateView(null==s?void 0:s.id),!E.isEmpty(this.intermediateView)))return;s&&s.id!==this.apiDefinitionId&&v.default.updateURL("build.apiDefinition",{apiId:this.apiId,apiVersionId:this.apiVersionId,apiDefinitionId:s.id},i),this.setAPIDefinitionModel(s),this.releaseId=E.get(i,"version"),this.viewParam=E.get(i,"view"),this.branch=E.get(i,"branch"),this.initialize(),this._cacheQueryParams();const a=await(0,b.getAPI)(this.apiId);this.deleteApiReactionDisposer=(0,c.reaction)((()=>E.get(a,"isDeleted")),(e=>{e&&this.setStatus("deleted","This definition has been deleted")}),{fireImmediately:!0}),pm.eventBus.channel("__apiEditor").subscribe((e=>{"deleted"===(0,P.getEventName)(e)&&(0,P.getEventData)(e).id===this.apiId&&this.setStatus("deleted","This definition has been deleted")}))}catch(e){return pm.logger.error("DefinitionWorkbenchController~didCreate",e),void this.setLoading(!1)}}async initialize(){const e=(0,l.resolveStoreInstance)(p.default);(0,c.when)((()=>e.isLoaded)).then((()=>{var i;const t=e&&(null===(i=e.find(this.apiId))||void 0===i?void 0:i.name);this.setTitle(t)})),this.apiDefinitionModel.getFileContent({fileId:this.apiDefinitionModel.mainNodeId}),this.setLoading(!1),this.handleViewParams(),this.modelDeleteReactionDisposer&&this.modelDeleteReactionDisposer(),this.modelDeleteReactionDisposer=(0,c.reaction)((()=>this.apiDefinitionModel.isDeleted),(e=>{e&&this.initialize()}))}setLoading(e){this.isModelLoading=e}setAPIDefinitionModel(e){this.apiDefinitionModel=e}setIntermediateView(e){this.intermediateView=e}async handleViewParams(){let{view:e,...i}=this.queryParams;if("file"===e){let e=await this.apiDefinitionModel.getRedirectionFileId();(0,h.handleDefinitionNavigation)({apiId:this.apiId,apiVersionId:this.apiVersionId,definitionId:this.apiDefinitionId,urlType:u.DEFINITION_URL_TYPES.FILE,fileId:e},{...i})}}didActivate(){const{routeParams:e,queryParams:i}=this.getRouteConfig(),t=(0,l.resolveStoreInstance)(d.APIDefinitionStore),n=t.getStoreKey(null==e?void 0:e.apiDefinitionId,null==i?void 0:i.version);t.updateActiveItem(d.MAIN_NODE_ID,n)}beforeDestroy(){this.modelDeleteReactionDisposer&&this.modelDeleteReactionDisposer(),this.deleteApiReactionDisposer&&this.deleteApiReactionDisposer()}didQueryParamsChange(e){(0,f.getUpdatedQueryParamsList)(e,this._prevQueryParams).some((e=>["version","branch"].includes(e)))&&(0,c.transaction)((()=>{I.default.suspendEditor(this.tabId),I.default.restoreEditor(this.tabId)})),this._cacheQueryParams(e)}_cacheQueryParams(){this._prevQueryParams=this.getQueryParams()}async determineIntermediateView(e){var i;let t,n=!1;if((null===(i=this.apiMode)||void 0===i?void 0:i.name)===D.BUILDER_VIEW&&E.has(this.queryParams,"branch")&&E.isEmpty(e))this.setIntermediateView(_);else{try{t=await(0,b.resolveAPIRelationId)(this.apiId,"apiDefinition",this.apiDefinitionId)}catch(i){E.includes(["apiUnmigratedError","apiDefinitionDoesntExistOnTheAPI"],i.name)?n=!0:"apiDefinitionConsumerDuplicateDoesntExistOnTheAPI"===i.name&&E.has(this.queryParams,"branch")&&(n=!0,this.consumerDefinitionId=e,this.setIntermediateView(j))}t===this.apiDefinitionId||n||(t?(this.consumerDefinitionId=t,this.setIntermediateView(j)):this.setIntermediateView(_))}}handleRequestForAccessOnParentAPI(){this.apiId&&(0,b.requestAccessOnAPI)(this.apiId)}handleRedirectToAPIConsumerDefinition(){const e=(0,h.getQueryParamsForMode)(this.apiMode);if(!this.consumerDefinitionId)return v.default.transitionTo("build.api",{apiId:this.apiId},e);v.default.transitionTo("build.apiDefinition",{apiId:this.apiId,apiVersionId:this.apiVersionId,apiDefinitionId:this.consumerDefinitionId},Object.assign(this.queryParams,e))}},s=w(n.prototype,"apiDefinitionModel",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=w(n.prototype,"isModelLoading",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),o=w(n.prototype,"intermediateView",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w(n.prototype,"setLoading",[c.action],Object.getOwnPropertyDescriptor(n.prototype,"setLoading"),n.prototype),w(n.prototype,"setAPIDefinitionModel",[c.action],Object.getOwnPropertyDescriptor(n.prototype,"setAPIDefinitionModel"),n.prototype),w(n.prototype,"setIntermediateView",[c.action],Object.getOwnPropertyDescriptor(n.prototype,"setIntermediateView"),n.prototype),n)},"./js/utils/urlUtils.js":function(e,i,t){function n(e={},i={}){let t=[];return Object.keys(e).forEach((n=>{e[n]!==i[n]&&t.push(n)})),t}t.r(i),t.d(i,{getUpdatedQueryParamsList:function(){return n}})},"./schema/constants/Constants.js":function(e,i,t){t.r(i),t.d(i,{INTERMEDIATE_DEFINITION_VIEW:function(){return s},resourceTypeEnum:function(){return n}});const n={APIDEFINITION:"apiDefinition",SCHEMA:"schema"},s={API_NO_PERMISSION:"api-no-permission",API_REDIRECT_CONSUMER_ENTITY:"api-redirect"}}}]);