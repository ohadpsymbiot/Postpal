"use strict";(self.webpackChunk_postman_app_renderer=self.webpackChunk_postman_app_renderer||[]).push([[91],{"./api-dev/components/api-version/context-bar/CommentsContextBarView/CommentsContextBarView.js":function(e,t,o){o.r(t),o.d(t,{default:function(){return R}});var n,s=o("../../node_modules/react/index.js"),r=o("../../node_modules/mobx-react/dist/mobx-react.module.js"),a=o("./js/stores/SyncStatusStore.js"),i=(o("./js/stores/TeamUserStore.js"),o("./js/stores/CurrentUserStore.js")),l=o("./js/stores/AnnotationStore.js"),m=o("./js/stores/StoreManager.js"),d=o("./js/stores/CommentStore.js"),c=o("./js/utils/UserHelper.js"),h=o("./collaboration/services/ContextBarCommentService.js"),p=o("./collaboration/components/comments/InlineCommentDrawer.js"),u=(o("./js/models/services/DashboardService.js"),o("./js/components/base/Buttons.js")),f=o("./js/components/base/Dropdowns.js"),C=o("./js/components/base/Inputs.js"),v=o("../../node_modules/@postman/aether-icons/esmLib/src/Icon/Icon.js"),S=o("./node_modules/classnames/index.js"),b=o.n(S),g=o("./js/modules/services/InlineCommentTransformerService.js"),E=o("./appsdk/contextbar/ContextBarViewHeader.js"),I=o("./api-dev/components/common/APIOffline/APIOffline.js"),_=o("./collaboration/services/PermissionService.js"),j=o("./collaboration/constants/comments.js"),x=o("./collaboration/services/CollaborationNavigationService.js"),w=o("./api-dev/constants/APISubViews.js"),D=o("./collaboration/utils/commentUtils.js"),F=o("./node_modules/lodash/lodash.js");let R=(0,r.observer)(n=class extends s.Component{constructor(e){super(e),this.state={loading:!0,loadError:!1,hasError:!1,isOpenFilterSelected:!0,isResolvedFilterSelected:!1,isScrollable:!0},this.rightOverlayModalRef=null,this.parseError=this.parseError.bind(this),this.handleRetry=this.handleRetry.bind(this),this.handleResolvedFilter=this.handleResolvedFilter.bind(this),this.handleOpenFilter=this.handleOpenFilter.bind(this),this.setCommentDrawerRef=this.setCommentDrawerRef.bind(this),this.stopScroll=this.stopScroll.bind(this),this.handleClose=this.handleClose.bind(this),this.onInlineCommentThreadHeaderClick=this.onInlineCommentThreadHeaderClick.bind(this)}async componentDidMount(){this.setState({loading:!0,loadError:!1}),g.default.handleAnalytics("api","view","api"),h.default.getComments({model:this.props.contextData.commentModel,modelId:this.props.contextData.commentModelId}).then((()=>{requestIdleCallback((()=>{(0,m.resolveStoreInstance)(d.default).setLoaded(!0),this.setState({loading:!1,loadError:!1})}))})).catch((e=>{this.setState({loading:!1,loadError:!0})}));let{model:e,modelId:t}=(0,D.getCommentPermissionModelInfo)({model:j.MODEL_TYPE.API,modelId:F.get(this.props,"contextData.commentModelId")}),{addComment:o,deleteComment:n,resolveComment:s}=await(0,_.fetchPermissions)(["addComment","deleteComment","resolveComment"],t,e);this.setState({addCommentPermission:o,deleteCommentPermission:n,resolveCommentPermission:s})}componentDidUpdate(){if(!this.state.isResolvedFilterSelected){const e=(0,m.resolveStoreInstance)(d.default),t=e.find(e.activeCommentId),o=(0,m.resolveStoreInstance)(l.default).find(F.get(t,"annotationId"));F.get(o,"status.resolved")&&this.handleResolvedFilter()}}handleOpenFilter(){this.setState((e=>{if(!e.isOpenFilterSelected||e.isResolvedFilterSelected)return{isOpenFilterSelected:!e.isOpenFilterSelected}}))}handleResolvedFilter(){this.setState((e=>{if(e.isOpenFilterSelected||!e.isResolvedFilterSelected)return{isResolvedFilterSelected:!e.isResolvedFilterSelected}}))}parseError(e){return e.isFriendly?e.message:""}handleRetry(){return this.setState({loading:!0,loadError:!1}),h.default.getComments({model:this.props.contextData.commentModel,modelId:this.props.contextData.commentModelId}).then((()=>{this.setState({loading:!1,loadError:!1})})).catch((e=>{this.setState({loading:!1,loadError:!0})}))}setCommentDrawerRef(e){this.commentDrawerRef=e,this.commentDrawerRef&&this.forceUpdate()}stopScroll(e){this.setState({isScrollable:!e})}handleClose(){this.props.onClose&&this.props.onClose(),x.default.removeCommentQueryParam()}onInlineCommentThreadHeaderClick(){F.isFunction(this.props.contextData.handleTabChange)&&this.props.contextData.handleTabChange(w.DEFINE)}render(){var e;let t,{commentModel:o,commentModelId:n}=this.props.contextData||{};t=F.filter((0,m.resolveStoreInstance)(d.default).values,(e=>e.model===o&&e.modelId===n));const r=F.filter(t,(e=>!e.anchor||e.anchor===`${o}/${n}`)),l=F.orderBy(r,"createdAt","desc"),h=(null===(e=this.props.contextData)||void 0===e?void 0:e.apiName)||"API",S=(0,m.resolveStoreInstance)(i.default)||{},g=(0,D.getUsersToTag)(),_=F.reduce(g,((e,t)=>(e[t.id]={name:t.name,id:t.id,username:t.username,email:t.email,profilePicUrl:t.profilePicUrl,roles:t.roles},e)),{}),j=Object.values(_),x=!(0,m.resolveStoreInstance)(a.default).isSocketConnected,w=(0,c.isUserAdmin)(S),R=F.reduce((l||[]).reverse(),((e,t)=>(e.includes(t.annotationId)||e.push(t.annotationId),e)),[]),y=(0,m.resolveStoreInstance)(d.default),k=y.find(y.activeCommentId),P=y.setActiveCommentId;return x&&this.state.loading?s.createElement(s.Fragment,null,s.createElement(E.ContextBarViewHeader,{onClose:this.props.onClose,title:"Comments"}),s.createElement(I.default,{origin:"context-bar"})):s.createElement("div",{className:b()({"comment-drawer-container":!0,"no-scroll":!this.state.isScrollable}),ref:this.setCommentDrawerRef},s.createElement(E.ContextBarViewHeader,{onClose:this.handleClose,title:"Comments"},s.createElement("div",{className:"comment-drawer-container__actions"},s.createElement("div",{className:"comment-drawer-container__actions-filter"},s.createElement(f.Dropdown,null,s.createElement(f.DropdownButton,{dropdownStyle:"nocaret"},s.createElement(u.Button,{className:"comment-drawer-container__actions-filter-button",type:"tertiary",tooltip:"Filter comments",disabled:!0},s.createElement(v.default,{name:"icon-action-filter-stroke"}))),s.createElement(f.DropdownMenu,{className:"comment-drawer-container__actions-filter-menu"},s.createElement("div",{className:"comment-drawer-container__actions-filter--action-header"},"Filter by"),s.createElement("div",{className:"comment-drawer-container__actions-filter--action-item"},s.createElement(C.Checkbox,{className:"comment-filter-dropdown-item-checkbox",checked:this.state.isOpenFilterSelected,onChange:this.handleOpenFilter}),s.createElement("span",{className:"comment-drawer-container__actions-filter--action-item-name"},"Open comments")),s.createElement("div",{className:"comment-drawer-container__actions-filter--action-item"},s.createElement(C.Checkbox,{className:"comment-filter-dropdown-item-checkbox",checked:this.state.isResolvedFilterSelected,onChange:this.handleResolvedFilter}),s.createElement("span",{className:"comment-drawer-container__actions-filter--action-item-name"},"Resolved comments"))))))),s.createElement("div",{className:"comment-drawer"},s.createElement(p.default,{editor:F.get(this.props.contextData,"editor"),comments:[],onInlineCommentThreadHeaderClick:this.onInlineCommentThreadHeaderClick,requestComments:l,annotationOrder:R,isResolvedFilterSelected:this.state.isResolvedFilterSelected,isOpenFilterSelected:this.state.isOpenFilterSelected,addCommentPermission:this.state.addCommentPermission,deleteCommentPermission:this.state.deleteCommentPermission,resolveCommentPermission:this.state.resolveCommentPermission,isAdmin:w,isOffline:x,loading:this.state.loading,loadError:this.state.loadError,hasError:this.state.hasError,teamUsers:j,teamUsersMap:_,onRetry:this.handleRetry,user:S,title:h,stopScroll:this.stopScroll,commentRef:this.commentDrawerRef,commentLinkDisabled:F.get(this.props.contextData,"commentLinkDisabled"),model:F.get(this.props.contextData,"commentModel"),modelId:F.get(this.props.contextData,"commentModelId"),activeComment:k,setActiveComment:P,origin:"contextBar",anchor:F.get(this.props.contextData,"anchor")})))}})||n},"./api-dev/components/common/APIOffline/APIOffline.js":function(e,t,o){o.r(t),o.d(t,{default:function(){return a}});var n=o("../../node_modules/react/index.js"),s=o("../../node_modules/@postman/aether/esmLib/src/components/Illustration/illustrations/CheckInternetConnection.js"),r=o("../../node_modules/@postman/aether/esmLib/src/components/Text/Text.js");class a extends n.Component{getHeadingColor(){return"sidebar"===this.props.origin?"content-color-secondary":"content-color-primary"}render(){return n.createElement("div",{className:`api-offline ${this.props.origin}`},n.createElement("div",{className:"api-offline__blank-state"},n.createElement(s.default,null)),n.createElement("div",{className:"api-offline__content"},n.createElement("div",{className:"api-offline__content__header"},n.createElement(r.default,{color:this.getHeadingColor(),typographyStyle:{fontSize:"text-size-l",fontWeight:"text-weight-medium",lineHeight:"line-height-m"}},"Unable to load data as you're offline")),n.createElement("div",{className:"api-offline__content__sub-header"},n.createElement(r.default,{color:"content-color-secondary",typographyStyle:{fontSize:"text-size-m",fontWeight:"text-weight-regular",lineHeight:"line-height-m"}},"Your data may not be up to date until youâ€™re back online."))))}}}}]);